# ビュー
- より複雑な問い合わせをするためには、**ビュー**と**サブクエリ**を使う

## ビューとは
- よく使う**SELECT文を保存**して、使い回すことのできる機能
- ビューが参照されると保存されたSELECT文を実行して**仮想のテーブル**を作る

---

- 商品分類ごとの商品数の確認を頻繁に行う必要がある場合、以下のSELECT文をその都度書く必要がある
    ```sql
    SELECT category, COUNT(*) FROM Products GROUP BY category;
    ```
    - 特定のSELECT文を頻繁に書くならば、その**SELECT文に名前をつけて保存**して、**名前を呼ぶだけで**そのSELECT文を**使える**ようにした方が楽になる


    ```sql
    CREATE VIEW ビュー名(<ビューのカラム名1>, <ビューのカラム名2>, ...)
    AS 
    <SELECT文>;
    ```

    - 例：商品カテゴリごとの個数をカウントしたテーブルを取得するビューを定義
    ```sql
    CREATE VIEW ProductSum(category, count_product)
    AS
    SELECT category, COUNT(*) FROM Products GROUP BY category;

    -- FROM句にビューを指定
    SELECT category, count_product FROM ProductSum;
    ```
    - 上がビューの定義、下が**保存したビューの利用**を行っている

    - **ビューの定義部分**
        - ASの前では**CREATE VIEW文**でビュー名とカラム名で保存される
        - 保存するSELECT文のカラムとビューのカラムは並び順で一致する
        - ビューは一度書いたら削除するまで保存される

    - **ビューの利用部分**
        - **FROM句の後**にテーブルではなくビューを指定することでビューを利用できる
        - FROM句にビューが指定されると、指定されたビューが保存しているSELECT文が実行されて、一時的に仮想的なテーブルを作成する

---

- ビューとテーブルの違いは、「**実データを保存しているかどうか**」である
- Productsテーブルは各レコードに実データを保存している
- ビューは**SELECT文を保存**している

---

- 実データを保存していないため、以下のメリットがある
    - **データ容量を節約できる**
    - どんなに大きなテーブルでも数行のSELECT文として保存できるため**データベースの変更に強い**
    - 呼び出された時にSELECT文を実行して仮想的なテーブルを作成するので、テーブルの中身が変更されても、変更されたデータをその都度取得できる。

---

- ビューの定義に並び替えをすることはできないため、ビューの呼び出し時に**ORDER BY**を使えば良い
- ビューを削除したい場合は、
    ```sql
    DROP VIEW ビュー名;
    ```
    とすれば良いので、

    - 例：ProductsSumビューを削除する
    ```sql
    DROP VIEW ProductSum;
    ```
---

- ポイント
    - ビューが保存しているのはデータではなくSELECT文！
    - SELECT文を保存するメリットは、
        - 頻繁に使うSELECT文をビューの名前を呼び出すだけで再利用できる
        - データ容量を節約できる
        - データベースの変更に強い
    - よく使うSELECT文はビューとして定義しておこう！
    - 並び替えはビューの定義時ではなく、利用時に使う！